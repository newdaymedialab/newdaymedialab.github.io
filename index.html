<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>NewDay Media Lab — AI POV Demo</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{--bg:#0b0f14;--panel:#0f1519;--accent:#f8b400;--muted:#9aa6b2;}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial;color:#e6eef6;background:linear-gradient(180deg,var(--bg),#071014);-webkit-font-smoothing:antialiased}
a{color:inherit;text-decoration:none}
.nav{position:sticky;top:0;display:flex;justify-content:space-between;padding:12px 20px;background:var(--panel);border-bottom:1px solid rgba(255,255,255,0.03)}
.nav .brand{display:flex;align-items:center;gap:12px}
.logo{width:44px;height:44px;border-radius:10px;display:grid;place-items:center;background:linear-gradient(135deg,var(--accent),#ffca3c)}
.logo svg{width:26px;height:26px}
.menu{display:flex;gap:18px;align-items:center}
.menu a{color:var(--muted);font-weight:600;padding:8px;border-radius:8px}
.menu a:hover{color:#fff;background:rgba(255,255,255,0.02)}
.cta{background:var(--accent);color:#071014;padding:8px 12px;border-radius:8px;font-weight:700;cursor:pointer}
.hero{max-width:1200px;margin:36px auto 18px;padding:28px 22px;display:grid;grid-template-columns:1fr 420px;gap:28px;align-items:center}
.hero-left h1{font-size:34px;margin:0 0 8px;color:#fff;line-height:1.03}
.hero-left p{margin:0 0 18px;color:var(--muted);font-size:15px}
.features{display:flex;gap:12px;flex-wrap:wrap}
.chip{background:var(--panel);padding:8px 12px;border-radius:999px;border:1px solid rgba(255,255,255,0.02);font-weight:600;color:var(--muted);font-size:13px;cursor:pointer}
.hero-right{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
.uploader{display:flex;flex-direction:column;gap:10px}
.uploader input[type=file]{display:none}
.upload-btn{display:inline-flex;align-items:center;gap:10px;background:transparent;border:1px dashed rgba(255,255,255,0.06);padding:12px;border-radius:10px;color:var(--muted);cursor:pointer}
.small{font-size:13px;color:var(--muted)}
.demo-thumb{width:100%;height:220px;border-radius:10px;background:linear-gradient(90deg,#071018,#0f1a22);display:flex;align-items:center;justify-content:center;border:1px solid rgba(255,255,255,0.02);color:var(--muted)}
canvas{width:100%;border-radius:10px;margin-top:10px;background:#000}
select{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:#e6eef6;font-weight:600;margin-top:6px}
@media(max-width:980px){.hero{grid-template-columns:1fr;padding:18px}.menu{display:none}}
</style>
</head>
<body>

<nav class="nav">
<div class="brand">
<div class="logo"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="9" fill="white" opacity="0.12"/><path d="M12 8a4 4 0 100 8 4 4 0 000-8z" fill="#071014" fill-opacity="0.9"/></svg></div>
<div><h3>NewDay Media Lab</h3><p class="muted">AI POV Demo</p></div>
</div>
<div class="menu">
<a href="#home">Home</a><a href="#project">Project</a><a href="#roadmap">Roadmap</a><a href="#support">Support</a>
</div>
<div style="display:flex;gap:10px;align-items:center">
<a class="cta" id="btnUploadTop">Upload</a>
</div>
</nav>

<main>
<section id="home" class="hero">
<div class="hero-left">
<h1>See the world through their eyes.</h1>
<p class="muted">Upload a short clip (5–59s) to generate a POV video using AI.</p>
<div class="features" style="margin-top:14px">
<span class="chip">Short clips • 5–59s</span>
<span class="chip">AI POV</span>
<span class="chip">Prototype</span>
</div>
<div style="margin-top:18px;display:flex;gap:12px;flex-wrap:wrap">
<a class="cta" id="heroUpload">Choose Video</a>
</div>
</div>

<aside class="hero-right">
<div class="uploader">
<div class="demo-thumb">Demo preview</div>
<label class="upload-btn" for="fileInput">Choose a video<input type="file" id="fileInput" accept="video/mp4,video/quicktime"></label>
<div class="small">Supported: MP4, MOV | Max 50MB</div>

<!-- Character POV -->
<select id="charSelect">
<option value="center">Character A — Center POV</option>
<option value="left">Character B — Left POV</option>
<option value="right">Character C — Right POV</option>
<option value="stabilize">Character D — Stabilized POV</option>
</select>

<!-- Color Filter -->
<select id="filterSelect">
<option value="none">No filter</option>
<option value="warm">Cinematic Warm</option>
<option value="blue">Sci-Fi Blue</option>
<option value="contrast">High Contrast</option>
<option value="noir">Noir (B&W)</option>
</select>

<div style="display:flex;gap:10px;margin-top:8px">
<button class="chip" id="btnGenerate">Generate POV</button>
<button class="chip" id="btnPreview">Preview</button>
</div>

<div id="uploadStatus" class="small muted" style="margin-top:8px">No file selected.</div>
<canvas id="previewCanvas" style="display:none;height:220px"></canvas>
</div>
</aside>
</section>
</main>

<script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.2/dist/ffmpeg.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded',()=>{
const { createFFmpeg, fetchFile }=FFmpeg;
const ffmpeg=createFFmpeg({ log:false });
const fileInput=document.getElementById('fileInput');
const uploadStatus=document.getElementById('uploadStatus');
const btnGenerate=document.getElementById('btnGenerate');
const btnPreview=document.getElementById('btnPreview');
const heroUpload=document.getElementById('heroUpload');
const btnUploadTop=document.getElementById('btnUploadTop');
const demoThumb=document.querySelector('.demo-thumb');
const previewCanvas=document.getElementById('previewCanvas');
const ctx=previewCanvas.getContext('2d');
const charSelect=document.getElementById('charSelect');
const filterSelect=document.getElementById('filterSelect');

[heroUpload,btnUploadTop].forEach(btn=>btn.addEventListener('click',()=>fileInput.click()));

let videoEl=document.createElement('video'); videoEl.crossOrigin='anonymous';
fileInput.addEventListener('change',()=>{
  const file=fileInput.files[0];
  if(!file){uploadStatus.textContent="No file selected."; return;}
  if(!['video/mp4','video/quicktime'].includes(file.type)){uploadStatus.textContent="Unsupported type!"; fileInput.value=''; return;}
  if(file.size>50*1024*1024){uploadStatus.textContent="File too large!"; fileInput.value=''; return;}
  videoEl.src=URL.createObjectURL(file);
  videoEl.load();
  videoEl.onloadedmetadata=()=>{
    if(videoEl.duration<5 || videoEl.duration>59){uploadStatus.textContent="Video must be 5–59s!"; fileInput.value=''; return;}
    uploadStatus.textContent=`File ready: ${file.name} (${Math.round(videoEl.duration)}s)`;
    demoThumb.style.display='none';
    previewCanvas.style.display='block';
  };
});

// Canvas Preview
function applyFilter(v,x,y,w,h,filter){
  ctx.drawImage(v,0,0,ctx.canvas.width,ctx.canvas.height);
  const img=ctx.getImageData(0,0,ctx.canvas.width,ctx.canvas.height);
  const data=img.data;
  for(let i=0;i<data.length;i+=4){
    let r=data[i],g=data[i+1],b=data[i+2];
    if(filter==='warm'){ r=r*1.05; g=g*1.02; b=b*0.98; }
    if(filter==='blue'){ r=r*0.95; g=g; b=b*1.08; }
    if(filter==='contrast'){ r=128+(r-128)*1.3; g=128+(g-128)*1.3; b=128+(b-128)*1.3; }
    if(filter==='noir'){ let avg=(r+g+b)/3; r=g=b=avg*1.15; }
    data[i]=Math.min(255,r); data[i+1]=Math.min(255,g); data[i+2]=Math.min(255,b);
  }
  ctx.putImageData(img,0,0);
}

function drawLoop(){ 
  if(videoEl.paused || videoEl.ended) return;
  let pov=charSelect.value;
  let filter=filterSelect.value;
  let sx=0, sy=0, sw=videoEl.videoWidth, sh=videoEl.videoHeight;
  if(pov==='left'){ sx=0; sw*=0.6; } 
  if(pov==='right'){ sx=videoEl.videoWidth*0.4; sw*=0.6; } 
  if(pov==='center'){ sw*=0.6; sh*=0.6; } 
  if(pov==='stabilize'){ sw*=0.7; sh*=0.7; }
  ctx.drawImage(videoEl,sx,sy,sw,sh,0,0,previewCanvas.width,previewCanvas.height);
  applyFilter(videoEl,0,0,sw,sh,filter);
  requestAnimationFrame(drawLoop);
}

btnPreview.addEventListener('click',()=>{
  if(!videoEl.src){alert("Select a video first"); return;}
  videoEl.play();
  drawLoop();
  uploadStatus.textContent="Previewing on canvas...";
});

// POV Generation
let ffmpegLoaded=false;
async function ensureFFmpeg(){if(ffmpegLoaded) return; uploadStatus.textContent='Loading FFmpeg...'; await ffmpeg.load(); ffmpegLoaded=true; uploadStatus.textContent='FFmpeg loaded';}
function buildFilter(pov,filter){
  let vf='';
  if(pov==='center') vf='crop=in_w*0.6:in_h*0.6,scale=640:360';
  if(pov==='left') vf='crop=in_w*0.6:in_h*0.6:0:0,scale=640:360';
  if(pov==='right') vf='crop=in_w*0.6:in_h*0.6:in_w*0.4:0,scale=640:360';
  if(pov==='stabilize') vf='crop=in_w*0.7:in_h*0.7,scale=640:360';
  if(filter==='warm') vf+=',eq=gamma_r=1.05:gamma_g=1.02:gamma_b=0.98:saturation=1.08';
  if(filter==='blue') vf+=',eq=gamma_r=0.95:gamma_g=1.0:gamma_b=1.08:saturation=1.1';
  if(filter==='contrast') vf+=',eq=contrast=1.3:saturation=1.05';
  if(filter==='noir') vf+=',format=gray,eq=contrast=1.15';
  return vf;
}

btnGenerate.addEventListener('click',async()=>{
  const file=fileInput.files[0];
  if(!file){alert("Select a file first"); return;}
  await ensureFFmpeg();
  uploadStatus.textContent='Generating POV video...';
  const inputName='input.mp4', outName='output_pov.mp4';
  ffmpeg.FS('writeFile', inputName, await fetchFile(file));
  const vf=buildFilter(charSelect.value, filterSelect.value);
  try{
    await ffmpeg.run('-i',inputName,'-vf',vf,'-preset','veryfast',outName);
    const data=ffmpeg.FS('readFile',outName);
    const url=URL.createObjectURL(new Blob([data.buffer],{type:'video/mp4'}));
    const a=document.createElement('a'); a.href=url; a.download='newday_pov.mp4'; a.click();
    uploadStatus.textContent='✅ POV video ready — downloaded.';
  }catch(e){console.error(e); uploadStatus.textContent='❌ Generation failed.';}
});
});
</script>

</body>
</html>
